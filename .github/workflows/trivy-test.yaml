name: Trivy test
on:
  pull_request:
    paths:
      - '**/*.tf'
jobs:
  trivy:
    name: Trivy test
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    - name: Run Trivy vulnerability scanner in fs mode with reviewdog output on PR
      uses: reviewdog/action-trivy@v1
      with:
        github_token: ${{ secrets.github_token }}
        trivy_command: config
        trivy_target: "${{ github.workspace }}/terraform"
        working_directory: "terraform"
        reporter: github-pr-review
        fail_on_error: true
        fail_level: any
